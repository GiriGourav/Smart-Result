<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin - Add Student</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Chrome, Safari, Edge */
        .no-spin::-webkit-outer-spin-button,
        .no-spin::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
        </head>
        <body class="bg-gray-100 py-10 px-4">

        <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-8">
            <div class="flex justify-between mb-8">
                <h2 class="text-3xl font-bold text-center text-blue-800 mb-8">Add Student & Marks</h2>

                <form th:action="@{'/logout'}" method="POST">
                    <button type="submit" class="text-white px-3 py-2 bg-blue-700 rounded">Logout</button>
                </form>
            </div>

            <form
                    th:action="@{'/results/process-form'}"
                    th:object="${studentForm}"
                    method="post"
                    enctype="multipart/form-data"
                    id="studentForm"
                    class="space-y-8">

                <!-- Student Info -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Student Information</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block mb-1 font-medium text-gray-700">Name</label>
                            <input type="text" th:field="*{name}" placeholder="Enter Student Name"
                                   class="w-full border rounded-xl px-4 py-2" required>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-gray-700">Roll Number</label>
                            <input type="text" th:field="*{rollNumber}" class="w-full border rounded-xl px-4 py-2" required>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-gray-700">Email</label>
                            <input type="email" th:field="*{email}" class="w-full border rounded-xl px-4 py-2" required>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-gray-700">Gender</label>
                            <select th:field="*{gender}" class="w-full border rounded-xl px-4 py-2" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-gray-700">Date of Birth</label>
                            <input type="date" th:field="*{dob}" class="w-full border rounded-xl px-4 py-2" required>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium text-gray-700">School Name</label>
                            <input type="text" th:field="*{schoolName}" class="w-full border rounded-xl px-4 py-2" required>
                        </div>
                    </div>
                </div>

                <!-- Marks Section -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Subject Marks</h3>
                    <div class="space-y-6 mark_fields_container" id="mark_fields_container">
                        <!-- Initial 2 Subject Rows -->
                        <div class="grid md:grid-cols-7 gap-4" id="mark_fields_0">
                            <input name="marks[0].subject" type="text" placeholder="Subject"
                                   class="col-span-2 border rounded-xl px-3 py-2" required>
                            <input name="marks[0].marks" type="number" placeholder="Marks" class="border rounded-xl px-3 py-2 no-spin" required>
                            <input name="marks[0].maxMarks" type="number" placeholder="Max Marks" class="border rounded-xl px-3 py-2 no-spin" required>
                            <input name="marks[0].remark" type="text" placeholder="Remark" class="border rounded-xl px-3 py-2" required>

                            <div class="relative">
                                <input type="file" id="answerSheet_0" name="marks[0].answerSheet" accept="application/pdf"
                                       class="hidden" onchange="updateFileName(0)" required>
                                <label for="answerSheet_0" class="flex items-center gap-2 border rounded-xl px-3 py-2 cursor-pointer hover:bg-gray-100">
                                    <img src="/mnt/data/aec9de17-0b55-43d0-b668-e06de39bf8ba.png" alt="Upload" class="w-6 h-6">
                                    <span id="file-name-0" class="text-gray-700 text-sm">Upload Answer Sheet</span>
                                </label>
                            </div>
                            <button disabled type="button" class="text-white disabled:bg-gray-700 bg-red-700 px-3 py-2 rounded">Remove</button>
                        </div>

                        <div class="grid md:grid-cols-7 gap-4" id="mark_fields_1">
                            <input name="marks[1].subject" type="text" placeholder="Subject"
                                   class="col-span-2 border rounded-xl px-3 py-2" required>
                            <input name="marks[1].marks" type="number" placeholder="Marks" class="border rounded-xl px-3 py-2 no-spin" required>
                            <input name="marks[1].maxMarks" type="number" placeholder="Max Marks" class="border rounded-xl px-3 py-2 no-spin" required>
                            <input name="marks[1].remark" type="text" placeholder="Remark" class="border rounded-xl px-3 py-2" required>

                            <div class="relative">
                                <input type="file" id="answerSheet_1" name="marks[1].answerSheet" accept="application/pdf"
                                       class="hidden" onchange="updateFileName(1)" required>
                                <label for="answerSheet_1" class="flex items-center gap-2 border rounded-xl px-3 py-2 cursor-pointer hover:bg-gray-100">
                                    <img src="/mnt/data/aec9de17-0b55-43d0-b668-e06de39bf8ba.png" alt="Upload" class="w-6 h-6">
                                    <span id="file-name-1" class="text-gray-700 text-sm">Upload Answer Sheet</span>
                                </label>
                            </div>
                            <button disabled type="button" class="text-white disabled:bg-gray-700 bg-red-700 px-3 py-2 rounded">Remove</button>
                        </div>
                    </div>

                    <div class="flex justify-center my-5">
                        <button type="button" onclick="addRow()" class="text-white bg-orange-700 px-3 py-2 rounded">Add Subject Mark</button>
                    </div>
                </div>

                <!-- Submit -->
                <div class="text-center">
                    <button type="submit"
                            class="bg-blue-600 text-white px-6 py-3 rounded-xl text-lg hover:bg-blue-700 transition">
                        Save Student & Result
                    </button>
                </div>
            </form>
        </div>

        <script>
            let index = 2;

            function addRow() {
                const container = document.getElementById("mark_fields_container");
                container.insertAdjacentHTML('beforeend', `
                    <div class="grid md:grid-cols-7 gap-4" id="mark_fields_${index}">
                        <input name="marks[${index}].subject" type="text" placeholder="Subject"
                               class="col-span-2 border rounded-xl px-3 py-2" required>
                        <input name="marks[${index}].marks" type="number" placeholder="Marks" class="border rounded-xl px-3 py-2 no-spin" required>
                        <input name="marks[${index}].maxMarks" type="number" placeholder="Max Marks" class="border rounded-xl px-3 py-2 no-spin"  required>
                        <input name="marks[${index}].remark" type="text" placeholder="Remark" class="border rounded-xl px-3 py-2" required>

                        <div class="relative">
                            <input type="file" id="answerSheet_${index}" name="marks[${index}].answerSheet"
                                   accept="application/pdf" class="hidden" onchange="updateFileName(${index})" required>
                            <label for="answerSheet_${index}" class="flex items-center gap-2 border rounded-xl px-3 py-2 cursor-pointer hover:bg-gray-100">
                                <img src="/mnt/data/aec9de17-0b55-43d0-b668-e06de39bf8ba.png" alt="Upload" class="w-6 h-6">
                                <span id="file-name-${index}" class="text-gray-700 text-sm">Upload Answer Sheet</span>
                            </label>
                        </div>

                        <button type="button" class="text-white bg-red-700 px-3 py-2 rounded"
                                onclick="removeRow('mark_fields_${index}')">Remove</button>
                    </div>
                `);
                index++;
            }

            function removeRow(divId) {
                const div = document.getElementById(divId);
                if (div) div.remove();
            }

            function updateFileName(i) {
                const input = document.getElementById(`answerSheet_${i}`);
                const label = document.getElementById(`file-name-${i}`);
                if (input.files.length > 0) {
                    label.textContent = input.files[0].name;
                } else {
                    label.textContent = "Upload Answer Sheet";
                }
            }
        </script>

        </body>
        </html>
